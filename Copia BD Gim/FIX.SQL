SET TERM !!;

CREATE PROCEDURE FIX
AS
  DECLARE VARIABLE CLI INTEGER;
  DECLARE VARIABLE F1 DATE;
  DECLARE VARIABLE F2 DATE;
  DECLARE VARIABLE DISC INTEGER;
BEGIN
     FOR SELECT ID_CLIENTE FROM CLIENTES INTO :CLI
     DO
     BEGIN
          FOR SELECT DISTINCT(FECHA_ULTIMO_PAGO), FECHA_EFECTIVO, DISIPLINA FROM PAGO_APARATOS WHERE CLIENTE = :CLI
              INTO :F1, :F2, :DISC
          DO
          BEGIN
               INSERT INTO AUX VALUES(:CLI,:F1,:F2,:DISC);
               SUSPEND;
          END
     END
     DELETE FROM PAGO_APARATOS;
     SUSPEND;
     FOR SELECT CLIENTE, F1, F2, DISC FROM AUX INTO :CLI, :F1, :F2, :DISC
     DO
     BEGIN
          INSERT INTO PAGO_APARATOS VALUES(:CLI,:F1,:F2,:DISC);
          SUSPEND;
     END
END !!

SET TERM ;!!







